# Chat AP.KZ - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–∞—Ç–∞–º–∏

## –û–ø–∏—Å–∞–Ω–∏–µ
–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–∞—Ç–∞–º–∏ –∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ AP.KZ. –í–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏, –æ—Ç–¥–µ–ª–∞–º–∏, –¥–æ–ª–∂–Ω–æ—Å—Ç—è–º–∏, –∫–ª–∏–µ–Ω—Ç–∞–º–∏, –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞–º–∏ –∏ —à–∞–±–ª–æ–Ω–∞–º–∏ —Å–æ–æ–±—â–µ–Ω–∏–π.

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- **Backend**: Laravel 10
- **Frontend**: Vue.js 3
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: MySQL
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: Laravel Sanctum
- **API**: RESTful API

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- PHP 8.1+
- Composer
- Node.js 16+
- MySQL 8.0+

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
composer install
npm install
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
cp .env.example .env
php artisan key:generate
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `.env`:
```env
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=chat_ap_kz
DB_USERNAME=your_username
DB_PASSWORD=your_password
```

### –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏ —Å–∏–¥—ã
```bash
php artisan migrate
php artisan db:seed
```

### –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```bash
# Backend
php artisan serve

# Frontend (–≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
npm run dev
```

## –î–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–µ

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–∏—Å—Ç–µ–º—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:

#### üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
**–õ–æ–≥–∏–Ω**: `admin@erp.ap.kz`  
**–ü–∞—Ä–æ–ª—å**: `password`  
**–†–æ–ª—å**: `admin`
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ä–∞–∑–¥–µ–ª–∞–º —Å–∏—Å—Ç–µ–º—ã

#### üë®‚Äçüíº –ú–µ–Ω–µ–¥–∂–µ—Ä
**–õ–æ–≥–∏–Ω**: `manager@erp.ap.kz`  
**–ü–∞—Ä–æ–ª—å**: `password`  
**–†–æ–ª—å**: `manager`  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –î–æ—Å—Ç—É–ø –∫ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä—É –∏ –∫–ª–∏–µ–Ω—Ç–∞–º

#### üë∑ –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å
**–õ–æ–≥–∏–Ω**: `leader@erp.ap.kz`  
**–ü–∞—Ä–æ–ª—å**: `password`  
**–†–æ–ª—å**: `leader`  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ—Ç–¥–µ–ª–æ–º –∏ –ø—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏–π

### –¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
**–õ–æ–≥–∏–Ω**: `test@back-chat.ap.kz`  
**–ü–∞—Ä–æ–ª—å**: `password123`  
**–†–æ–ª—å**: `employee`

### –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```bash
# –°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
php artisan user:create-admin admin@example.com

# –°–æ–∑–¥–∞—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞
php artisan user:create-manager manager@example.com 1

# –ù–∞–∑–Ω–∞—á–∏—Ç—å —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
php artisan user:assign-role user@example.com admin
```

### –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω–∫–µ
```bash
# –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –≤—Ö–æ–¥–∞
php artisan admin:login admin@erp.ap.kz

# –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
php artisan profile:show --all
```

## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### ‚ùå –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ (CSRF —Ç–æ–∫–µ–Ω—ã)
**–í–ù–ò–ú–ê–ù–ò–ï**: –≠—Ç–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —É—Å—Ç–∞—Ä–µ–ª–∏! API —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Bearer —Ç–æ–∫–µ–Ω—ã, –∞ –Ω–µ CSRF.

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (SPA + Bearer —Ç–æ–∫–µ–Ω—ã)
API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Laravel Sanctum —Å –≥–∏–±—Ä–∏–¥–Ω—ã–º –ø–æ–¥—Ö–æ–¥–æ–º:
- **CSRF —Ç–æ–∫–µ–Ω—ã** –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç CSRF –∞—Ç–∞–∫ –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ
- **Bearer —Ç–æ–∫–µ–Ω—ã** –¥–ª—è API –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞
- **Cookies** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞ "419 CSRF token mismatch" —Ä–µ—à–µ–Ω–∞** - –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π flow –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

### üîÑ Flow –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:

```
1. –§—Ä–æ–Ω—Ç–µ–Ω–¥ ‚Üí GET /api/csrf-token ‚Üí –ü–æ–ª—É—á–∞–µ—Ç CSRF —Ç–æ–∫–µ–Ω
2. –§—Ä–æ–Ω—Ç–µ–Ω–¥ ‚Üí POST /api/auth/login (—Å CSRF —Ç–æ–∫–µ–Ω–æ–º) ‚Üí –ü–æ–ª—É—á–∞–µ—Ç Bearer —Ç–æ–∫–µ–Ω
3. –§—Ä–æ–Ω—Ç–µ–Ω–¥ ‚Üí API –∑–∞–ø—Ä–æ—Å—ã —Å Bearer —Ç–æ–∫–µ–Ω–æ–º ‚Üí –î–æ—Å—Ç—É–ø –∫ –∑–∞—â–∏—â–µ–Ω–Ω—ã–º —Ä–µ—Å—É—Ä—Å–∞–º
```

**–ü–æ—á–µ–º—É –Ω—É–∂–µ–Ω CSRF —Ç–æ–∫–µ–Ω?**
- –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF –∞—Ç–∞–∫ –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ
- –í–∞–ª–∏–¥–∞—Ü–∏—è, —á—Ç–æ –∑–∞–ø—Ä–æ—Å –ø—Ä–∏—à–µ–ª –æ—Ç –ª–µ–≥–∏—Ç–∏–º–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
- Laravel Sanctum —Ç—Ä–µ–±—É–µ—Ç CSRF –¥–ª—è SPA –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### CORS –æ—à–∏–±–∫–∏
CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Bearer —Ç–æ–∫–µ–Ω–∞–º–∏. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏:

```javascript
// Axios
const api = axios.create({
  baseURL: 'https://back-chat.ap.kz/api',
  headers: {
    'Accept': 'application/json',
    'Content-Type': 'application/json',
  }
});

// –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –∫ –∑–∞–ø—Ä–æ—Å–∞–º
api.interceptors.request.use(config => {
  const token = localStorage.getItem('auth_token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// Fetch
const token = localStorage.getItem('auth_token');
fetch(url, {
  headers: {
    'Content-Type': 'application/json',
    'Accept': 'application/json',
    'Authorization': token ? `Bearer ${token}` : '',
  }
});
```

### –ü—Ä–æ–±–ª–µ–º–∞ —Å CSS (FOUC)
–û—à–∏–±–∫–∞ "–ú–∞–∫–µ—Ç –±—ã–ª –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–º–µ–Ω—ë–Ω –ø–µ—Ä–µ–¥ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã" - –ø—Ä–æ–±–ª–µ–º–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:

```html
<!-- –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ç–∏–ª–µ–π -->
<link rel="preload" href="/css/app.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="/css/app.css"></noscript>

<!-- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ CSS-in-JS –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è FOUC -->
```

## ‚úÖ –í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã!

### –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
1. **CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** - –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Bearer —Ç–æ–∫–µ–Ω–∞–º–∏
2. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω AuthService –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Sanctum
3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** - —Å–æ–∑–¥–∞–Ω—ã –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
4. **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∞ –Ω–∞ storage/logs –∏ storage/framework/views
5. **–ü–∞–ø–∫–∞ views** - —Å–æ–∑–¥–∞–Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∞—è –ø–∞–ø–∫–∞ resources/views
6. **–ö—ç—à** - –æ—á–∏—â–µ–Ω –≤–µ—Å—å –∫—ç—à Laravel –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
7. **SPA –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** - –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π flow: CSRF —Ç–æ–∫–µ–Ω ‚Üí –ª–æ–≥–∏–Ω ‚Üí Bearer —Ç–æ–∫–µ–Ω
8. **CSRF –∑–∞—â–∏—Ç–∞** - –¥–æ–±–∞–≤–ª–µ–Ω /api/csrf-token –∏ middleware –¥–ª—è SPA –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –†–∞–±–æ—á–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:
- **üëë –ê–¥–º–∏–Ω**: `admin@erp.ap.kz` / `password`
- **üë®‚Äçüíº –ú–µ–Ω–µ–¥–∂–µ—Ä**: `manager@erp.ap.kz` / `password`  
- **üë∑ –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å**: `leader@erp.ap.kz` / `password`
- **üß™ –¢–µ—Å—Ç**: `test@back-chat.ap.kz` / `password123`

### üîß –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (SPA + Bearer —Ç–æ–∫–µ–Ω—ã):

#### 1. –ü–æ–ª—É—á–∏—Ç—å CSRF —Ç–æ–∫–µ–Ω:
```javascript
// –ü–æ–ª—É—á–∞–µ–º CSRF —Ç–æ–∫–µ–Ω –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç CSRF –∞—Ç–∞–∫
const csrfResponse = await fetch('https://back-chat.ap.kz/api/csrf-token', {
  method: 'GET',
  credentials: 'include' // –í–∞–∂–Ω–æ –¥–ª—è cookies
});

const csrfData = await csrfResponse.json();
const csrfToken = csrfData.csrf_token;
```

#### 2. –í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É —Å CSRF —Ç–æ–∫–µ–Ω–æ–º:
```javascript
const response = await fetch('https://back-chat.ap.kz/api/auth/login', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Accept': 'application/json',
    'X-CSRF-TOKEN': csrfToken // CSRF –∑–∞—â–∏—Ç–∞
  },
  credentials: 'include', // –î–ª—è cookies
  body: JSON.stringify({
    email: 'admin@erp.ap.kz',
    password: 'password'
  })
});

const data = await response.json();
const token = data.data.token; // Bearer —Ç–æ–∫–µ–Ω
```

#### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Bearer —Ç–æ–∫–µ–Ω –¥–ª—è –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:
```javascript
const response = await fetch('https://back-chat.ap.kz/api/user', {
  headers: {
    'Authorization': `Bearer ${token}`,
    'Accept': 'application/json'
  }
});
```

#### 4. –í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã:
```javascript
const response = await fetch('https://back-chat.ap.kz/api/auth/logout', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Accept': 'application/json'
  }
});
```

### üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

#### –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:

**–î–ª—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (SPA):**
```javascript
class AuthService {
  constructor() {
    this.baseURL = 'https://back-chat.ap.kz/api';
    this.token = localStorage.getItem('auth_token');
  }

  async login(email, password) {
    try {
      // 1. –ü–æ–ª—É—á–∞–µ–º CSRF cookie
      await fetch('https://back-chat.ap.kz/sanctum/csrf-cookie', {
        credentials: 'include'
      });
      
      // 2. –í—ã–ø–æ–ª–Ω—è–µ–º –ª–æ–≥–∏–Ω —á–µ—Ä–µ–∑ SPA endpoint
      const response = await fetch(`${this.baseURL}/auth/spa/login`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json',
          'X-Requested-With': 'XMLHttpRequest'
        },
        credentials: 'include',
        body: JSON.stringify({ email, password })
      });

      const data = await response.json();
      
      if (data.success) {
        this.token = data.data.token;
        localStorage.setItem('auth_token', this.token);
```

**–î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π:**
```javascript
class AuthService {
  constructor() {
    this.baseURL = 'https://back-chat.ap.kz/api';
    this.token = localStorage.getItem('auth_token');
  }

  async login(email, password) {
    try {
      // –ü—Ä–æ—Å—Ç–æ–π API –±–µ–∑ CSRF
      const response = await fetch(`${this.baseURL}/auth/login`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json'
        },
        body: JSON.stringify({ email, password })
      });

      const data = await response.json();
      
      if (data.success) {
        this.token = data.data.token;
        localStorage.setItem('auth_token', this.token);
        return data;
      } else {
        throw new Error(data.message);
      }
    } catch (error) {
      console.error('Login error:', error);
      throw error;
    }
  }

  async logout() {
    try {
      await fetch(`${this.baseURL}/auth/logout`, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${this.token}`,
          'Accept': 'application/json'
        }
      });
      
      this.token = null;
      localStorage.removeItem('auth_token');
    } catch (error) {
      console.error('Logout error:', error);
    }
  }

  async getUser() {
    try {
      const response = await fetch(`${this.baseURL}/user`, {
        headers: {
          'Authorization': `Bearer ${this.token}`,
          'Accept': 'application/json'
        }
      });

      return await response.json();
    } catch (error) {
      console.error('Get user error:', error);
      throw error;
    }
  }

  isAuthenticated() {
    return !!this.token;
  }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
const auth = new AuthService();

// –í–æ–π—Ç–∏
await auth.login('admin@erp.ap.kz', 'password');

// –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const user = await auth.getUser();

// –í—ã–π—Ç–∏
await auth.logout();
```

## API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ë–∞–∑–æ–≤—ã–π URL
```
https://back-chat.ap.kz/api
```

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Bearer Token –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —á–µ—Ä–µ–∑ Laravel Sanctum.

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º
- [–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏](docs/API_ENDPOINTS.md)
- [–û—Ç–¥–µ–ª—ã](docs/API_DEPARTMENTS.md)
- [–î–æ–ª–∂–Ω–æ—Å—Ç–∏](docs/API_POSITIONS.md)
- [–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏](docs/API_EMPLOYEES.md)
- [–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã](docs/API_CONTRACTORS.md)
- [–ö–ª–∏–µ–Ω—Ç—ã](docs/API_CLIENTS.md)
- [–ß–∞—Ç—ã –∏ —Å–æ–æ–±—â–µ–Ω–∏—è](docs/API_CHATS_MESSAGES.md)
- [–®–∞–±–ª–æ–Ω—ã](docs/API_TEMPLATES.md)
- [–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è](docs/API_PROFILE.md)

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ Http/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Controllers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Api/          # API –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Resources/        # API —Ä–µ—Å—É—Ä—Å—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Requests/         # –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ Models/               # Eloquent –º–æ–¥–µ–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ Services/             # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ migrations/           # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ seeders/             # –°–∏–¥—ã
‚îú‚îÄ‚îÄ docs/                    # API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ public/                  # –ü—É–±–ª–∏—á–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îî‚îÄ‚îÄ routes/
    ‚îî‚îÄ‚îÄ api.php              # API –º–∞—Ä—à—Ä—É—Ç—ã
```

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- –†–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏
- –°–æ–∑–¥–∞–Ω–∏–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª–∞–º–∏ –∏ –¥–æ–ª–∂–Ω–æ—Å—Ç—è–º–∏
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

### –†–∞–±–æ—Ç–∞ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏
- –§–∏–∑–∏—á–µ—Å–∫–∏–µ –ª–∏—Ü–∞ (–±–µ–∑ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤)
- –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –ª–∏—Ü–∞ (—Å –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞–º–∏)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞–º–∏
- –ò—Å—Ç–æ—Ä–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π

### –°–∏—Å—Ç–µ–º–∞ —á–∞—Ç–æ–≤
- –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞–º–∏
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- –ü–µ—Ä–µ–¥–∞—á–∞ —á–∞—Ç–æ–≤ –º–µ–∂–¥—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏
- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

### –®–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π
- –°–æ–∑–¥–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ —à–∞–±–ª–æ–Ω–∞—Ö
- –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

## –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

| –†–æ–ª—å | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ |
|------|----------|---------------|
| `admin` | –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä | –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ä–∞–∑–¥–µ–ª–∞–º —Å–∏—Å—Ç–µ–º—ã |
| `manager` | –ú–µ–Ω–µ–¥–∂–µ—Ä | –î–æ—Å—Ç—É–ø –∫ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä—É –∏ –∫–ª–∏–µ–Ω—Ç–∞–º |
| `leader` | –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å | –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ—Ç–¥–µ–ª–æ–º –∏ –ø—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏–π |
| `employee` | –°–æ—Ç—Ä—É–¥–Ω–∏–∫ | –î–æ—Å—Ç—É–ø –∫ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä—É –∏ –∫–ª–∏–µ–Ω—Ç–∞–º |

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Laravel Sanctum
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF –∞—Ç–∞–∫
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –ø–æ —Ä–æ–ª—è–º
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
```bash
php artisan test
```

### –õ–∏–Ω—Ç–∏–Ω–≥ –∫–æ–¥–∞
```bash
./vendor/bin/pint
```

### –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
```bash
php artisan make:migration create_table_name
```

### –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
```bash
php artisan make:controller Api/ControllerName --api
```

## Troubleshooting

### 419 CSRF token mismatch

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ª–æ–≥–∏–Ω–∞ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –ø–æ–ª—É—á–∞–µ—Ç–µ –æ—à–∏–±–∫—É `419 CSRF token mismatch`.

**–†–µ—à–µ–Ω–∏–µ:**

1. **–î–ª—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (SPA) - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/api/auth/spa/login`:**
   ```javascript
   // 1. –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∏—Ç–µ CSRF cookie
   await fetch('https://back-chat.ap.kz/sanctum/csrf-cookie', {
     credentials: 'include'
   });
   
   // 2. –ó–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –ª–æ–≥–∏–Ω —á–µ—Ä–µ–∑ SPA endpoint
   const response = await fetch('https://back-chat.ap.kz/api/auth/spa/login', {
     method: 'POST',
     headers: {
       'Content-Type': 'application/json',
       'Accept': 'application/json',
       'X-Requested-With': 'XMLHttpRequest'
     },
     credentials: 'include',
     body: JSON.stringify({
       email: 'admin@erp.ap.kz',
       password: 'password'
     })
   });
   ```

2. **–î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/api/auth/login` (–±–µ–∑ CSRF):**
   ```javascript
   const response = await fetch('https://back-chat.ap.kz/api/auth/login', {
     method: 'POST',
     headers: {
       'Content-Type': 'application/json',
       'Accept': 'application/json'
     },
     body: JSON.stringify({
       email: 'admin@erp.ap.kz',
       password: 'password'
     })
   });
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é CORS:**
   ```bash
   # –í config/cors.php –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
   'allowed_origins' => ['https://chat.ap.kz', 'http://localhost:3000'],
   'supports_credentials' => true,
   'allowed_headers' => ['*'],
   ```

### CORS –æ—à–∏–±–∫–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** `Access to fetch at 'https://back-chat.ap.kz/api/auth/login' from origin 'https://chat.ap.kz' has been blocked by CORS policy`

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `config/cors.php`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à –¥–æ–º–µ–Ω –¥–æ–±–∞–≤–ª–µ–Ω –≤ `allowed_origins`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### CSS –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ç–∏–ª–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è, —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—ã–≥–ª—è–¥–∏—Ç –Ω–µ—Å—Ç–∏–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ CSS —Ñ–∞–π–ª—ã –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –ø—É—Ç—è–º
2. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤

### 500 Internal Server Error

**–ü—Ä–æ–±–ª–µ–º–∞:** API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É 500.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Laravel: `tail -f storage/logs/laravel.log`
2. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à: `php artisan config:clear && php artisan cache:clear`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã: `php artisan migrate:status`

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å–∏—Å—Ç–µ–º—ã.

## –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è AP.KZ. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
